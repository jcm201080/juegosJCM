{% extends "base.html" %}
{% block title %}Sala Bingo{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/bingo.css') }}">
{% endblock %}

{% block content %}
<section class="bingo-sala">
    <h1 class="bingo-title">
        <video
            src="{{ url_for('static', filename='img/bingo.mp4') }}"
            autoplay
            loop
            muted
            playsinline
            class="bingo-icon"
        ></video>
        Sala de Bingo
    </h1>

    <p class="bingo-player">
        ğŸŸï¸ Jugador: <strong>{{ session.username }}</strong>
    </p>

    <p>CÃ³digo de sala: <strong>{{ codigo }}</strong></p>

    <!-- âœ… Variable global accesible desde sala.js -->
    <script>
        window.CODIGO = "{{ codigo }}";
        window.BINGO_USER = "{{ session.username or '' }}";
    </script>

    <div id="estado-espera">
        <div id="estado">Esperando jugadores...</div>
    </div>

    <div id="controles-host">

        <div id="cartones-select">
            <label>ğŸŸï¸ Cartones:</label>
            <select id="numCartones">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>

        <button
            id="startGameBtn"
            class="btn-primary"
            style="display: none;"
        >
            â–¶ï¸ Iniciar partida
        </button>

        <!-- BotÃ³n solo para el host -->
        <button id="newBallBtn" class="btn-primary" style="display:none;">
            ğŸ± Sacar bola
        </button>

        <div class="auto-controls">
            <label for="intervalSelect">â± Intervalo:</label>

            <select id="intervalSelect" class="interval-select">
                <option value="1">1 s</option>
                <option value="5">5 s</option>
                <option value="10">10 s</option>
                <option value="15">15 s</option>
                <option value="20" selected>20 s</option>
                <option value="25">25 s</option>
                <option value="30">30 s</option>
                <option value="35">35 s</option>
                <option value="40">40 s</option>
            </select>

            <button id="autoPlayBtn" class="btn-auto">
                â–¶ Auto
            </button>

            <button id="pauseAutoBtn" class="btn-auto pause" style="display:none;">
                â¸ Pausa
            </button>

            <span id="autoCountdown" class="auto-countdown" style="display:none;">
                â³ 20s
            </span>
        </div>
    </div>
    

    <a href="#historial" class="btn-historial">Ver historial de bolas</a>

    <div id="vidas-container" class="vidas"></div>

    <div id="ultima-bola" class="bola-actual">
        <span class="bola-label">Bolas actuales</span>

        <div class="bola-actual-lista">
            <!-- JS mete aquÃ­ hasta 4 bolas -->
        </div>
    </div>
   

    <!-- AquÃ­ se pintan los cartones -->
    <div id="carton-container"></div>    

    <div class="bingo-validaciones">
        <button id="btnLinea" class="btn-linea">ğŸ¯ Cantar lÃ­nea</button>
        <button id="btnCruz" class="btn-cruz">â• Cantar cruz</button>
        <button id="btnX" class="btn-x">âŒ Cantar X</button>
        <button id="btnBingo" class="btn-bingo">ğŸ† Cantar bingo</button>
    </div>

    <div class="ranking-box">
        <h3>ğŸ† Ranking</h3>
        <ul id="ranking-list"></ul>
    </div>

    <div class="historial-bolas" id="historial">
        <h3>historial de bolas</h3>
        <div id="bolas-container"></div>
    </div>


    <button id="resetBtn" class="btn-secondary">
        ğŸ”„ Salir de la sala
    </button>

    <div id="toast" class="toast hidden"></div>
    <div id="aviso-cantar" class="aviso-cantar hidden"></div>
</section>
{% endblock %}

{% block extra_js %}
<script
    type="module"
    src="{{ url_for('static', filename='js/bingo/sala.js') }}?v=20260203">
</script>
{% endblock %}
