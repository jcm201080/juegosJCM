{% extends "base.html" %} {% block title %}Juego de CÃ¡lculo RÃ¡pido{% endblock %} {% block extra_css
%}
<link rel="stylesheet" href="{{ url_for('static', filename='css/juego_mate.css') }}" />
{% endblock %} {% block content %}
<div class="game-container">
    <h1>Juego de CÃ¡lculo RÃ¡pido</h1>

    <!-- ğŸ”¹ Panel de estado de usuario (usa window.JCM_USER, NO login propio) -->
    <div class="user-panel">
        <!-- Vista invitado -->
        <div id="gameUserGuest">
            <p class="user-status">
                EstÃ¡s jugando como <strong>invitado</strong>. Inicia sesiÃ³n desde la parte superior
                para guardar tus puntuaciones y aparecer en el ranking.
            </p>
        </div>

        <!-- Vista usuario logueado -->
        <div id="gameUserLogged" class="hidden">
            <p>ğŸ‘¤ SesiÃ³n iniciada como: <strong id="currentUserName"></strong></p>
            <p>
                ğŸ† Mejor puntuaciÃ³n global (todos los niveles):
                <span id="currentUserBestScore">0</span>
            </p>
            <p>ğŸ“ˆ PuntuaciÃ³n acumulada: <span id="currentUserTotalScore">0</span></p>
            <p>ğŸš Mejor puntuaciÃ³n en este nivel: <span id="currentUserLevelBestScore">0</span></p>
        </div>
    </div>

    <hr />

    <!-- BLOQUE DEL JUEGO -->
    <div class="top-info">
        <div>â± Tiempo: <span id="time">60</span>s</div>
        <div>â­ Puntos: <span id="score">0</span></div>
        <div class="level-wrapper">
            <label for="levelSelect">Nivel:</label>
            <select id="levelSelect">
                <option value="1">Nivel 1 â€” Sumas (1â€“10)</option>
                <option value="2">Nivel 2 â€” Sumas y restas (resultado â‰¥ 0)</option>
                <option value="3">Nivel 3 â€” Sumas y restas (1â€“20)</option>
                <option value="4">Nivel 4 â€” Tablas de multiplicar</option>
                <option value="5">Nivel 5 â€” Operaciones mixtas (+ âˆ’ Ã— Ã·)</option>
                <option value="6">Nivel 6 â€” Ecuaciones de 1Âº grado</option>
                <option value="7">Nivel 7 â€” Ecuaciones de 2Âº grado</option>
            </select>

            <!-- ğŸ”¹ AquÃ­ saldrÃ¡ el texto dinÃ¡mico del nivel -->
            <span id="levelDescription" class="level-description"></span>
        </div>
    </div>

    <div class="question-box" id="question">Pulsa "Empezar"</div>

    <div class="answers">
        <button class="answer" data-index="0"></button>
        <button class="answer" data-index="1"></button>
        <button class="answer" data-index="2"></button>
        <button class="answer" data-index="3"></button>
    </div>

    <div class="controls">
        <button class="btn-main" id="startBtn">Empezar partida</button>
    </div>

    <div class="message" id="message"></div>
</div>

<!-- Ranking centrado debajo -->
<div class="ranking-container">
    <section id="rankingSection">
        <h2>ğŸ† Ranking global</h2>
        <ul id="globalRankingList"></ul>

        <h3>ğŸ¯ Ranking del nivel actual</h3>
        <p id="levelRankingTitle"></p>
        <ul id="levelRankingList"></ul>
    </section>

    <section id="historySection">
        <h2>ğŸ“œ Historial de partidas</h2>
        <button id="showHistoryBtn">Ver / ocultar historial</button>
        <ul id="historyList" style="display: none"></ul>
    </section>
</div>

<a href="{{ url_for('main.home') }}" class="back-link">â¬… Volver a Juegos JCM</a>

<!-- Sonidos del juego -->
<audio id="soundCorrect" src="{{ url_for('static', filename='sounds/correct.wav') }}" preload="auto"></audio>
<audio id="soundWrong" src="{{ url_for('static', filename='sounds/wrong.wav') }}" preload="auto"></audio>
<audio id="soundEnd" src="{{ url_for('static', filename='sounds/end.wav') }}" preload="auto"></audio>

{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/juego_mate.js') }}" defer></script>
{% endblock %}
